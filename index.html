<!doctype html>
<html lang="en-us">
<head>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <title>Geometry Dash - BoxedWine</title>
    <meta content="boxedwine emulator" name="description">
    <link href="boxedwine.css" rel="stylesheet">
</head>
<body>
    <div id="loading">
        <figure id="spinner" style="overflow:visible"><div class="spinner"></div></figure>
        <div id="status" class="emscripten">Downloading Geometry Dash...</div>
        <div class="emscripten"><progress hidden id="progress" max="100" value="0"></progress></div>
    </div>

    <div id="inline">
        <div class="emscripten">
            <button onclick="start()" id="startbtn" style="display:none">Start</button>
            <input id="pointerLock" type="checkbox" checked>Lock Mouse
            <input type="button" onclick="Module.requestFullScreen(document.getElementById('pointerLock').checked, true)" value="Fullscreen">
        </div>
        <div id="dropzone">
            <div class="emscripten_border">
                <canvas class="emscripten" id="canvas" oncontextmenu="event.preventDefault()"></canvas>
            </div>
        </div>
    </div>

    <!-- Core Boxedwine Scripts -->
    <script src="browserfs.boxedwine.js"></script>
    <script src="jszip.min.js"></script>
    <script src="boxedwine-shell.js"></script>
    
    <script>
        /**
         * CONFIGURATION
         * Boxedwine mounts the 'app' zip file to D: internally.
         */
        const blobUrl = "https://hufwcfvnhfhjlm5c.public.blob.vercel-storage.com/Geometry%20Dash.zip";
        const exePath = "d:/Geometry Dash/GeometryDash.exe";
        const workingDir = "d:/Geometry Dash";

        const params = new URLSearchParams(window.location.search);
        
        // If the URL doesn't already have the app loaded, redirect to include it
        if (!params.has('app')) {
            const newUrl = new URL(window.location.href);
            newUrl.searchParams.set('app', blobUrl);
            newUrl.searchParams.set('p', exePath);
            newUrl.searchParams.set('work', "Geometry Dash"); // Tells emulator to look in this folder for DLLs/Assets
            window.location.href = newUrl.href;
        }
    </script>
    
    <!-- The main engine script -->
    <script src="boxedwine.js" async></script>
</body>
</html>
